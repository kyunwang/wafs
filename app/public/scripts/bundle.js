!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t};function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var n={errorPage:function(t){var n;return{overview:(e(n={},"home-title","Oops something went wrong"),e(n,"error-message",""+t),e(n,"show-all",""),e(n,"show-current",""),e(n,"show-completed",""),e(n,"show-planned",""),e(n,"items",[{item__type:"anime",item__link:{item__name:"test",item__image:"hello",item__rating:88}}]),n)}},userOverview:function(n){var a,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",s=n.data,o=n.included;if(s.length<2)return console.log("no stuff"),this.errorPage("Oops the user has nothing in here");var u=o.filter(function(t){return"users"===t.type}),l=o.filter(function(t){return t.type===r});return{overview:(e(a={},"home-title","Hi, "+u[0].attributes.name+". This is your "+("anime"==r?"watchlist":"readlist")),e(a,"show-planned","anime"===r?"Want to see":"Want to read"),e(a,"items",l.map(function(e,n){return t({item__type:e.type,item__link:{item__name:e.attributes.canonicalTitle,item__image:"",item__rating:"0.0"===s[n].attributes.rating?"-":2*s[n].attributes.rating}},e.attributes,s[n].attributes)})),a),directives:(e(i={},"show-all",{href:function(){return"#library/"+("anime"===r?"":"manga")}}),e(i,"show-current",{href:function(){return"#library/"+("anime"===r?"current":"manga/current")}}),e(i,"show-completed",{href:function(){return"#library/"+("anime"===r?"completed":"manga/completed")}}),e(i,"show-planned",{href:function(){return"#library/"+("anime"===r?"planned":"manga/planned")}}),e(i,"items",{item__link:{href:function(){return"#"+this.item__type+"/"+this.slug}},item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}),i)}},overview:function(n){var a,i=n.data,r=(e(a={},"page-title","anime"===n.data[0].type?"Check some anime":"Check some manga"),e(a,"items",i.map(function(e){return t({id:e.id,slug:e.attributes.slug,item__type:e.type,item__rating:e.attributes.averageRating?Math.floor(e.attributes.averageRating):"-",item__link:{item__name:e.attributes.canonicalTitle,item__image:""}},e.attributes)})),a);return{overview:r,directives:{items:{item__link:{href:function(){return"#"+this.item__type+"/"+this.slug}},item__image:{src:function(){if(this.posterImage)return this.posterImage.medium},alt:function(){return this.slug}}}}}},detail:function(e){var n=e.type,a=e.attr,i=void 0===a?e.attributes:a,r=e.rel;void 0===r&&e.relationschips;return{overview:t({item__name:i.canonicalTitle,item__image:"",item__synopsis:i.synopsis,item__rating:i.averageRating?Math.floor(i.averageRating):"-",item__totalChOrEps:"anime"===n?i.episodeCount:i.chaperCount},i),directives:{item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}}}},a={getHash:function(){return location.hash},getElement:function(t){return document.querySelector(t)},getElements:function(t){return document.querySelectorAll(t)},toInt:function(t){return parseInt(t,10)},stringify:function(t){return JSON.stringify(t)},parse:function(t){return JSON.parse(t)},setData:function(t,e){return localStorage.setItem(t,this.stringify(e))},getData:function(t){return this.parse(localStorage.getItem(t))},deleteData:function(t){return localStorage.removeItem(t)},checkData:function(t){return null===t||"undefined"===t||t.errors},renderTemplate:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"anime",s=n[e](i,r),o=s.overview,u=s.directives;return Transparency.render(a.getElement(t),o,u)}},i=function(t){return console.log("Oops a error: ",t),t},r={baseUrl:"https://kitsu.io/api/edge",baseHeader:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"},getMoreLink:{anime:"",manga:"",userManga:"",userAnime:""},get:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return await fetch(this.baseUrl+"/"+t+"?page[limit]="+e+"&page[offset]="+n,{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return i(t)})},getTrending:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"anime";return await fetch("https://kitsu.io/api/edge/trending/"+t,{headers:this.baseHeader}).then(function(t){return t.json()}).then(function(t){return console.log(t),t}).catch(function(t){return i(t)})},searchForUser:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return await fetch("https://kitsu.io/api/edge/users?filter%5Bname%5D="+t,{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return i(t)})},getUserData:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:182702,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return await fetch("\n\t\t\t\thttps://kitsu.io/api/edge/library-entries\n\t\t\t\t?\n\t\t\t\tfields["+(e||"anime")+"]=\n\t\t\t\tslug,\n\t\t\t\tposterImage,\n\t\t\t\tcanonicalTitle,\n\t\t\t\ttitles,\n\t\t\t\tsynopsis,\n\t\t\t\tsubtype,\n\t\t\t\tstartDate,\n\t\t\t\tstatus,\n\t\t\t\taverageRating,\n\t\t\t\tpopularityRank,\n\t\t\t\tratingRank,\n\t\t\t\t&filter[user_id]="+(t||182702)+"\n\t\t\t\t&filter[kind]="+(e||"anime")+"\n\t\t\t\t&include=\n\t\t\t\t"+(e||"anime")+",\n\t\t\t\tuser\n\t\t\t\t&page[offset]=0\n\t\t\t\t&page[limit]="+(n||20)+"\n\t\t\t\t&sort=\n\t\t\t\tstatus\n\t\t\t",{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return i(t)})},getUserDataFilter:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:182702,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return await fetch("\n\t\t\t\thttps://kitsu.io/api/edge/library-entries\n\t\t\t\t?\n\t\t\t\tfields["+(e||"anime")+"]=\n\t\t\t\tslug,\n\t\t\t\tposterImage,\n\t\t\t\tcanonicalTitle,\n\t\t\t\ttitles,\n\t\t\t\tsynopsis,\n\t\t\t\tsubtype,\n\t\t\t\tstartDate,\n\t\t\t\tstatus,\n\t\t\t\taverageRating,\n\t\t\t\tpopularityRank,\n\t\t\t\tratingRank,\n\t\t\t\t&filter[user_id]="+(t||182702)+"\n\t\t\t\t&filter[kind]="+(e||"anime")+"\n\t\t\t\t&filter[status]="+(n||"current")+"\t\t\t\t\n\t\t\t\t&include=\n\t\t\t\t"+(e||"anime")+",\n\t\t\t\tuser\n\t\t\t\t&page[offset]=0\n\t\t\t\t&page[limit]="+(a||20)+"\n\t\t\t\t&page[offset]="+(r||0)+"\n\t\t\t\t&sort=\n\t\t\t\tstatus\n\t\t\t",{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return i(t)})},getMoreData:async function(t){return await fetch(r.getMoreLink[t],{headers:this.baseHeader}).then(function(t){return t.json()}).then(function(e){return r.getMoreLink[t]=e.links.next,e}).catch(function(t){return i(t)})}},s={allRoutes:[],searchUserInput:"",searchUserBtn:"",userView:"",overviewView:"",detailView:"",userId:""},o={animeData:{},mangaData:{},userDataAnime:{},userDataManga:{}};function u(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var l,c={init:function(){this.routes(),s.userId=a.getData("userId"),location.hash||routie("library")},routes:function(){routie({library:async function(){console.log("Homepage",o),c.toggle("library");var t=a.getData("userData");a.checkData(t)||(s.userView.classList.add("anim__view--show"),o.userDataAnime=t,r.getMoreLink.userAnime=t.links.next,a.renderTemplate(".view__home","userOverview",o.userDataAnime),c.onScrollBottom("userAnime","userDataAnime",".view__home","userOverview"))},"library/manga":async function(){console.log("Library Manga",o);var t=a.getData("userDataManga");a.checkData(t)||(s.userView.classList.add("anim__view--show"),o.userDataManga=t,r.getMoreLink.userManga=t.links.next,a.renderTemplate(".view__home","userOverview",o.userDataManga,"manga"),c.onScrollBottom("userManga","userDataManga",".view__home","userOverview","manga"))},"library/:query":function(t){console.log("Library query: ",t);var e=s.userId||a.getData("userId");s.userView.classList.remove("anim__view--show"),c.loader.show(),r.getUserDataFilter(e,"anime",t,20,0).then(function(t){return o.userDataAnime=t}).then(function(t){a.renderTemplate(".view__home","userOverview",o.userDataAnime),s.userView.classList.add("anim__view--show"),c.loader.hide()})},"library/manga/:query":function(t){console.log("Library query Manga: ",t);var e=s.userId||a.getData("userId");s.userView.classList.remove("anim__view--show"),c.loader.show(),r.getUserDataFilter(e,"manga",t,20,0).then(function(t){return o.userDataManga=t}).then(function(t){a.renderTemplate(".view__home","userOverview",o.userDataManga,"manga"),s.userView.classList.add("anim__view--show"),c.loader.hide()})},anime:function(){console.log("Anime overview"),c.toggle("overview");var t=a.getData("animeData");a.renderTemplate(".view__overview","overview",t),s.overviewView.classList.add("anim__view--show"),c.onScrollBottom("anime","animeData",".view__overview","overview")},"anime/:slug":function(t){console.log("Anime slug: ",t),c.toggle("details");var e=a.getData("animeData").data.filter(function(e){return e.attributes.slug===t});e.length||(e=a.getData("userData").included.filter(function(e){return e.attributes.slug===t})),a.renderTemplate(".detail","detail",e[0]),s.detailView.classList.add("anim__view--show"),window.onscroll=function(){}},manga:function(){console.log("Manga Overview"),c.toggle("overview");var t=a.getData("mangaData");a.renderTemplate(".view__overview","overview",t),s.overviewView.classList.add("anim__view--show"),c.onScrollBottom("manga","mangaData",".view__overview","overview")},"manga/:slug":function(t){console.log("Manga slug: ",t),c.toggle("details");var e=a.getData("mangaData").data.filter(function(e){return e.attributes.slug===t});e.length||(e=a.getData("userDataManga").included.filter(function(e){return e.attributes.slug===t})),a.renderTemplate(".detail","detail",e[0]),s.detailView.classList.add("anim__view--show"),window.onscroll=function(){}}})},toggle:function(t){console.log("Change route to: ",t),s.allRoutes.forEach(function(e){e.id===t?e.classList.remove("inactive"):e.classList.add("inactive")})},loader:{self:a.getElement("#loader"),show:function(){this.self.classList.remove("inactive")},hide:function(){this.self.classList.add("inactive")}},onScrollBottom:function(t,e,n,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"anime";window.onscroll=function(){var l=document.documentElement;l.scrollTop+window.innerHeight>=l.offsetHeight-1&&(r.getMoreData(t).then(function(t){return o[e]={data:[].concat(u(o[e].data),u(t.data)),links:t.links,meta:t.meta,included:t.included?[].concat(u(o[e].included),u(t.included)):[]},t}).then(function(t){a.renderTemplate(n,i,o[e],s)}),console.log("At the bottom"))}}},m=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&o.return&&o.return()}finally{if(i)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();l=function(){var t=s.searchUserBtn,e=s.searchUserInput;t.addEventListener("click",async function(t){if(t.preventDefault(),e.value.length){s.userView.classList.remove("anim__view--show"),c.loader.show();var i=await r.searchForUser(e.value);if(i.data.length){o.userDataAnime=[],o.userDataManga=[];var u=await Promise.all([r.getUserData(i.data[0].id,null,20),r.getUserData(i.data[0].id,"manga",20)]),l=m(u,2),g=l[0],d=l[1];s.userId=i.data[0].id,a.setData("userId",i.data[0].id),a.setData("userData",g),a.setData("userDataManga",d),a.renderTemplate(".view__home","userOverview",g),s.userView.classList.add("anim__view--show"),c.loader.hide(),routie("library")}else{var v=n.errorPage("We cannot find "+e.value).overview;a.renderTemplate(".view__home",v),s.userView.classList.add("anim__view--show"),c.loader.hide()}}})},async function(){console.log("Initializing app");var t=a.getData("animeData"),e=a.getData("mangaData"),n=void 0,i=void 0;if(null===t||"undefined"===t||null===e||"undefined"===e){console.log("No anime data so set");var u=await Promise.all([a.getElements(".view"),r.get("anime",20),r.get("manga",20)]),g=m(u,3);s.allRoutes=g[0],n=g[1],i=g[2],a.setData("animeData",n),a.setData("mangaData",i),o.animeData=n,o.mangaData=i,r.getMoreLink.anime=n.links.next,r.getMoreLink.manga=i.links.next}else o.animeData=t,o.mangaData=e,r.getMoreLink.anime=t.links.next,r.getMoreLink.manga=e.links.next;var d=await Promise.all([a.getElements(".view"),a.getElement("#search-user-input"),a.getElement("#search-user-btn"),a.getElement(".view__home .anim__view"),a.getElement("#overview .anim__view"),a.getElement("#details .anim__view")]),v=m(d,6);s.allRoutes=v[0],s.searchUserInput=v[1],s.searchUserBtn=v[2],s.userView=v[3],s.overviewView=v[4],s.detailView=v[5],l(),c.init()}()});
