"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(a,i){try{var o=t[a](i),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){var e,t,n,r,a,i,o,s,u={errorPage:function(e){var t;return{overview:(_defineProperty(t={},"home-title","Oops something went wrong"),_defineProperty(t,"error-message",""+e),_defineProperty(t,"show-all",""),_defineProperty(t,"show-current",""),_defineProperty(t,"show-completed",""),_defineProperty(t,"show-planned",""),_defineProperty(t,"items",[{item__type:"anime",item__link:{item__name:"test",item__image:"hello",item__rating:88}}]),t)}},userOverview:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",a=e.data,i=e.included;if(a.length<2)return console.log("no stuff"),this.errorPage("Oops the user has nothing in here");var o=i.filter(function(e){return"users"===e.type}),s=i.filter(function(e){return e.type===r});return{overview:(_defineProperty(t={},"home-title","Hi, "+o[0].attributes.name+". This is your "+("anime"==r?"watchlist":"readlist")),_defineProperty(t,"show-planned","anime"===r?"Want to see":"Want to read"),_defineProperty(t,"items",s.map(function(e,t){return _extends({item__type:e.type,item__link:{item__name:e.attributes.canonicalTitle,item__image:"",item__rating:"0.0"===a[t].attributes.rating?"-":2*a[t].attributes.rating}},e.attributes,a[t].attributes)})),t),directives:(_defineProperty(n={},"show-all",{href:function(){return"#library/"+("anime"===r?"":"manga")}}),_defineProperty(n,"show-current",{href:function(){return"#library/"+("anime"===r?"current":"manga/current")}}),_defineProperty(n,"show-completed",{href:function(){return"#library/"+("anime"===r?"completed":"manga/completed")}}),_defineProperty(n,"show-planned",{href:function(){return"#library/"+("anime"===r?"planned":"manga/planned")}}),_defineProperty(n,"items",{item__link:{href:function(){return"#"+this.item__type+"/"+this.slug}},item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}),n)}},overview:function(e){var t,n=e.data,r=(_defineProperty(t={},"page-title","anime"===e.data[0].type?"Check some anime":"Check some manga"),_defineProperty(t,"items",n.map(function(e){return _extends({id:e.id,slug:e.attributes.slug,item__type:e.type,item__rating:e.attributes.averageRating?Math.floor(e.attributes.averageRating):"-",item__link:{item__name:e.attributes.canonicalTitle,item__image:""}},e.attributes)})),t);return{overview:r,directives:{items:{item__link:{href:function(){return"#"+this.item__type+"/"+this.slug}},item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}}}},detail:function(e){var t=e.type,n=e.attr,r=void 0===n?e.attributes:n,a=e.rel;void 0===a&&e.relationschips;return{overview:_extends({item__name:r.canonicalTitle,item__image:"",item__synopsis:r.synopsis,item__rating:r.averageRating?Math.floor(r.averageRating):"-",item__totalChOrEps:"anime"===t?r.episodeCount:r.chaperCount},r),directives:{item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}}}},c={getHash:function(){return location.hash},getElement:function(e){return document.querySelector(e)},getElements:function(e){return document.querySelectorAll(e)},shortenString:function(e,t,n){return n?e.substr(t,n):e.substr(t)},toInt:function(e){return parseInt(e,10)},stringify:function(e){return JSON.stringify(e)},parse:function(e){return JSON.parse(e)},setData:function(e,t){return localStorage.setItem(e,this.stringify(t))},getData:function(e){return this.parse(localStorage.getItem(e))},deleteData:function(e){return localStorage.removeItem(e)},checkData:function(e){return null===e||"undefined"===e||e.errors},renderTemplate:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"anime",a=u[t](n,r),i=a.overview,o=a.directives;return Transparency.render(c.getElement(e),i,o)}},l=function(e){return console.log("Oops a error: ",e),e},m={baseUrl:"https://kitsu.io/api/edge",baseHeader:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"},getMoreLink:{anime:"",manga:"",userManga:"",userAnime:""},get:(i=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.baseUrl+"/"+t+"?page[limit]="+n+"&page[offset]="+r,{headers:this.baseHeader}).then(function(e,t){return e.json()}).catch(function(e){return l(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)}),getTrending:(a=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"anime";arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://kitsu.io/api/edge/trending/"+t,{headers:this.baseHeader}).then(function(e){return e.json()}).then(function(e){return console.log(e),e}).catch(function(e){return l(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)}),searchForUser:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://kitsu.io/api/edge/users?filter%5Bname%5D="+t,{headers:this.baseHeader}).then(function(e,t){return e.json()}).catch(function(e){return l(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)}),getUserData:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:182702,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("\n\t\t\t\thttps://kitsu.io/api/edge/library-entries\n\t\t\t\t?\n\t\t\t\tfields["+(n||"anime")+"]=\n\t\t\t\tslug,\n\t\t\t\tposterImage,\n\t\t\t\tcanonicalTitle,\n\t\t\t\ttitles,\n\t\t\t\tsynopsis,\n\t\t\t\tsubtype,\n\t\t\t\tstartDate,\n\t\t\t\tstatus,\n\t\t\t\taverageRating,\n\t\t\t\tpopularityRank,\n\t\t\t\tratingRank,\n\t\t\t\t&filter[user_id]="+(t||182702)+"\n\t\t\t\t&filter[kind]="+(n||"anime")+"\n\t\t\t\t&include=\n\t\t\t\t"+(n||"anime")+",\n\t\t\t\tuser\n\t\t\t\t&page[offset]=0\n\t\t\t\t&page[limit]="+(r||20)+"\n\t\t\t\t&sort=\n\t\t\t\tstatus\n\t\t\t",{headers:this.baseHeader}).then(function(e,t){return e.json()}).catch(function(e){return l(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)}),getUserDataFilter:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:182702,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("\n\t\t\t\thttps://kitsu.io/api/edge/library-entries\n\t\t\t\t?\n\t\t\t\tfields["+(n||"anime")+"]=\n\t\t\t\tslug,\n\t\t\t\tposterImage,\n\t\t\t\tcanonicalTitle,\n\t\t\t\ttitles,\n\t\t\t\tsynopsis,\n\t\t\t\tsubtype,\n\t\t\t\tstartDate,\n\t\t\t\tstatus,\n\t\t\t\taverageRating,\n\t\t\t\tpopularityRank,\n\t\t\t\tratingRank,\n\t\t\t\t&filter[user_id]="+(t||182702)+"\n\t\t\t\t&filter[kind]="+(n||"anime")+"\n\t\t\t\t&filter[status]="+(r||"current")+"\t\t\t\t\n\t\t\t\t&include=\n\t\t\t\t"+(n||"anime")+",\n\t\t\t\tuser\n\t\t\t\t&page[offset]=0\n\t\t\t\t&page[limit]="+(a||20)+"\n\t\t\t\t&page[offset]="+(i||0)+"\n\t\t\t\t&sort=\n\t\t\t\tstatus\n\t\t\t",{headers:this.baseHeader}).then(function(e,t){return e.json()}).catch(function(e){return l(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)}),getMoreData:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(m.getMoreLink[t],{headers:this.baseHeader}).then(function(e){return e.json()}).then(function(e){return m.getMoreLink[t]=e.links.next,e}).catch(function(e){return l(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},g={allRoutes:[],searchUserInput:"",searchUserBtn:"",userView:"",overviewView:"",detailView:"",userId:""},d={animeData:{},mangaData:{},userDataAnime:{},userDataManga:{}},f={init:function(){this.routes(),g.userId=c.getData("userId"),location.hash||routie("library")},routes:function(){var e,t;routie({library:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Homepage",d),f.toggle("library"),t=c.getData("userData"),!c.checkData(t)){e.next=7;break}return e.abrupt("return");case 7:g.userView.classList.add("anim__view--show"),d.userDataAnime=t,m.getMoreLink.userAnime=t.links.next,c.renderTemplate(".view__home","userOverview",d.userDataAnime),f.onScrollBottom("userAnime","userDataAnime",".view__home","userOverview");case 12:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)}),"library/manga":(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Library Manga",d),t=c.getData("userDataManga"),!c.checkData(t)){e.next=6;break}return e.abrupt("return");case 6:g.userView.classList.add("anim__view--show"),d.userDataManga=t,m.getMoreLink.userManga=t.links.next,c.renderTemplate(".view__home","userOverview",d.userDataManga,"manga"),f.onScrollBottom("userManga","userDataManga",".view__home","userOverview","manga");case 11:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)}),"library/:query":function(e){console.log("Library query: ",e);var t=g.userId||c.getData("userId");g.userView.classList.remove("anim__view--show"),f.loader.show(),m.getUserDataFilter(t,"anime",e,20,0).then(function(e){return d.userDataAnime=e}).then(function(e){c.renderTemplate(".view__home","userOverview",d.userDataAnime),g.userView.classList.add("anim__view--show"),f.loader.hide()})},"library/manga/:query":function(e){console.log("Library query Manga: ",e);var t=g.userId||c.getData("userId");g.userView.classList.remove("anim__view--show"),f.loader.show(),m.getUserDataFilter(t,"manga",e,20,0).then(function(e){return d.userDataManga=e}).then(function(e){c.renderTemplate(".view__home","userOverview",d.userDataManga,"manga"),g.userView.classList.add("anim__view--show"),f.loader.hide()})},anime:function(){console.log("Anime overview"),f.toggle("overview");var e=c.getData("animeData");c.renderTemplate(".view__overview","overview",e),g.overviewView.classList.add("anim__view--show"),f.onScrollBottom("anime","animeData",".view__overview","overview")},"anime/:slug":function(e){console.log("Anime slug: ",e),f.toggle("details");var t=c.getData("animeData").data.filter(function(t){return t.attributes.slug===e});t.length||(t=c.getData("userData").included.filter(function(t){return t.attributes.slug===e})),c.renderTemplate(".detail","detail",t[0]),g.detailView.classList.add("anim__view--show"),window.onscroll=function(){}},manga:function(){console.log("Manga Overview"),f.toggle("overview");var e=c.getData("mangaData");c.renderTemplate(".view__overview","overview",e),g.overviewView.classList.add("anim__view--show"),f.onScrollBottom("manga","mangaData",".view__overview","overview")},"manga/:slug":function(e){console.log("Manga slug: ",e),f.toggle("details");var t=c.getData("mangaData").data.filter(function(t){return t.attributes.slug===e});t.length||(t=c.getData("userDataManga").included.filter(function(t){return t.attributes.slug===e})),c.renderTemplate(".detail","detail",t[0]),g.detailView.classList.add("anim__view--show"),window.onscroll=function(){}}})},toggle:function(e){console.log("Change route to: ",e),g.allRoutes.forEach(function(t){t.id===e?t.classList.remove("inactive"):t.classList.add("inactive")})},loader:{self:c.getElement("#loader"),show:function(){this.self.classList.remove("inactive")},hide:function(){this.self.classList.add("inactive")}},onScrollBottom:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"anime";window.onscroll=function(){var i=document.documentElement;i.scrollTop+window.innerHeight>=i.offsetHeight-1&&(m.getMoreData(e).then(function(e){return d[t]={data:[].concat(_toConsumableArray(d[t].data),_toConsumableArray(e.data)),links:e.links,meta:e.meta,included:e.included?[].concat(_toConsumableArray(d[t].included),_toConsumableArray(e.included)):[]},e}).then(function(e){c.renderTemplate(n,r,d[t],a)}),console.log("At the bottom"))}}};s={init:function(){var e,t=this,n=g.searchUserBtn,r=g.searchUserInput;n.addEventListener("click",(e=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var a,i,o,s,l,h,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),r.value.length){e.next=3;break}return e.abrupt("return");case 3:return g.userView.classList.remove("anim__view--show"),f.loader.show(),e.next=7,m.searchForUser(r.value);case 7:if(!(a=e.sent).data.length){e.next=27;break}return d.userDataAnime=[],d.userDataManga=[],e.next=13,Promise.all([m.getUserData(a.data[0].id,null,40),m.getUserData(a.data[0].id,"manga",40)]);case 13:i=e.sent,o=_slicedToArray(i,2),s=o[0],l=o[1],g.userId=a.data[0].id,c.setData("userId",a.data[0].id),c.setData("userData",s),c.setData("userDataManga",l),c.renderTemplate(".view__home","userOverview",s),g.userView.classList.add("anim__view--show"),f.loader.hide(),routie("library"),e.next=31;break;case 27:h=u.errorPage("We cannot find "+r.value),v=h.overview,c.renderTemplate(".view__home",v),g.userView.classList.add("anim__view--show"),f.loader.hide();case 31:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))}},(o=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,a,i,o,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Initializing app"),t=c.getData("animeData"),n=c.getData("mangaData"),r=void 0,a=void 0,null!==t&&"undefined"!==t&&null!==n&&"undefined"!==n){e.next=21;break}return console.log("No anime data so set"),e.next=8,Promise.all([c.getElements(".view"),m.get("anime",20),m.get("manga",20)]);case 8:i=e.sent,o=_slicedToArray(i,3),g.allRoutes=o[0],r=o[1],a=o[2],c.setData("animeData",r),c.setData("mangaData",a),d.animeData=r,d.mangaData=a,m.getMoreLink.anime=r.links.next,m.getMoreLink.manga=a.links.next,e.next=25;break;case 21:d.animeData=t,d.mangaData=n,m.getMoreLink.anime=t.links.next,m.getMoreLink.manga=n.links.next;case 25:return e.next=27,Promise.all([c.getElements(".view"),c.getElement("#search-user-input"),c.getElement("#search-user-btn"),c.getElement(".view__home .anim__view"),c.getElement("#overview .anim__view"),c.getElement("#details .anim__view")]);case 27:u=e.sent,l=_slicedToArray(u,6),g.allRoutes=l[0],g.searchUserInput=l[1],g.searchUserBtn=l[2],g.userView=l[3],g.overviewView=l[4],g.detailView=l[5],s.init(),f.init();case 37:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})()}();