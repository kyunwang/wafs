!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";var t,e=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},a=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&o.return&&o.return()}finally{if(i)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},r={errorPage:function(t){var n;return{overview:(e(n={},"home-title","Oops something went wrong"),e(n,"error-message",""+t),e(n,"show-all",""),e(n,"show-current",""),e(n,"show-completed",""),e(n,"show-planned",""),e(n,"items",[{item__type:"anime",item__link:{item__name:"test",item__image:"hello",item__rating:88}}]),n)}},userOverview:function(t){var a,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",s=t.data,o=t.included;if(s.length<2)return console.log("no stuff"),this.errorPage("Oops the user has nothing in here");var u=o.filter(function(t){return"users"===t.type}),l=o.filter(function(t){return t.type===r});return{overview:(e(a={},"home-title","Hi, "+u[0].attributes.name+". This is your "+("anime"==r?"watchlist":"readlist")),e(a,"show-planned","anime"===r?"Want to see":"Want to read"),e(a,"items",l.map(function(t,e){return n({item__type:t.type,item__link:{item__name:t.attributes.canonicalTitle,item__image:"",item__rating:"0.0"===s[e].attributes.rating?"-":2*s[e].attributes.rating}},t.attributes,s[e].attributes)})),a),directives:(e(i={},"show-all",{href:function(){return"#library/"+("anime"===r?"":"manga")}}),e(i,"show-current",{href:function(){return"#library/"+("anime"===r?"current":"manga/current")}}),e(i,"show-completed",{href:function(){return"#library/"+("anime"===r?"completed":"manga/completed")}}),e(i,"show-planned",{href:function(){return"#library/"+("anime"===r?"planned":"manga/planned")}}),e(i,"items",{item__link:{href:function(){return"#"+this.item__type+"/"+this.slug}},item__image:{src:function(){if(this.posterImage)return this.posterImage.medium},alt:function(){return console.log(this),this.slug}}}),i)}},overview:function(t){var a,i=t.data,r=t.data[0].type,s=(e(a={},"page-title","anime"===r?"Check some anime":"Check some manga"),e(a,"items",i.map(function(t){return n({id:t.id,slug:t.attributes.slug,item__type:t.type,item__rating:t.attributes.averageRating?Math.floor(t.attributes.averageRating):"-",item__link:{item__name:t.attributes.canonicalTitle,item__image:""}},t.attributes)})),a);return{overview:s,directives:{items:{item__link:{href:function(){return"#"+this.item__type+"/"+this.slug}},item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}}}},detail:function(t){var e=t.type,a=t.attr,i=void 0===a?t.attributes:a,r=t.rel;void 0===r&&t.relationschips;return{overview:n({item__name:i.canonicalTitle,item__image:"",item__synopsis:i.synopsis,item__rating:i.averageRating?Math.floor(i.averageRating):"-",item__totalChOrEps:"anime"===e?i.episodeCount:i.chaperCount},i),directives:{item__image:{src:function(){if(this.posterImage)return this.posterImage.medium}}}}}},s={getHash:function(){return location.hash},getElement:function(t){return document.querySelector(t)},getElements:function(t){return document.querySelectorAll(t)},toInt:function(t){return parseInt(t,10)},stringify:function(t){return JSON.stringify(t)},parse:function(t){return JSON.parse(t)},setData:function(t,e){return localStorage.setItem(t,this.stringify(e))},getData:function(t){return this.parse(localStorage.getItem(t))},deleteData:function(t){return localStorage.removeItem(t)},checkData:function(t){return null===t||"undefined"===t||t.errors},renderTemplate:function(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"anime",i=r[e](n,a),o=i.overview,u=i.directives;return Transparency.render(s.getElement(t),o,u)}},o=function(t){return console.log("Oops a error: ",t),t},u={baseUrl:"https://kitsu.io/api/edge",baseHeader:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"},getMoreLink:{anime:"",manga:"",userManga:"",userAnime:""},get:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return await fetch(this.baseUrl+"/"+t+"?page[limit]="+e+"&page[offset]="+n,{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return o(t)})},getTrending:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"anime";return await fetch("https://kitsu.io/api/edge/trending/"+t,{headers:this.baseHeader}).then(function(t){return t.json()}).then(function(t){return console.log(t),t}).catch(function(t){return o(t)})},searchForUser:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return await fetch("https://kitsu.io/api/edge/users?filter%5Bname%5D="+t,{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return o(t)})},getUserData:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:182702,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return await fetch("\n\t\t\t\thttps://kitsu.io/api/edge/library-entries\n\t\t\t\t?\n\t\t\t\tfields["+(e||"anime")+"]=\n\t\t\t\tslug,\n\t\t\t\tposterImage,\n\t\t\t\tcanonicalTitle,\n\t\t\t\ttitles,\n\t\t\t\tsynopsis,\n\t\t\t\tsubtype,\n\t\t\t\tstartDate,\n\t\t\t\tstatus,\n\t\t\t\taverageRating,\n\t\t\t\tpopularityRank,\n\t\t\t\tratingRank,\n\t\t\t\t&filter[user_id]="+(t||182702)+"\n\t\t\t\t&filter[kind]="+(e||"anime")+"\n\t\t\t\t&include=\n\t\t\t\t"+(e||"anime")+",\n\t\t\t\tuser\n\t\t\t\t&page[offset]=0\n\t\t\t\t&page[limit]="+(n||20)+"\n\t\t\t\t&sort=\n\t\t\t\tstatus\n\t\t\t",{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return o(t)})},getUserDataFilter:async function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:182702,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anime",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return await fetch("\n\t\t\t\thttps://kitsu.io/api/edge/library-entries\n\t\t\t\t?\n\t\t\t\tfields["+(e||"anime")+"]=\n\t\t\t\tslug,\n\t\t\t\tposterImage,\n\t\t\t\tcanonicalTitle,\n\t\t\t\ttitles,\n\t\t\t\tsynopsis,\n\t\t\t\tsubtype,\n\t\t\t\tstartDate,\n\t\t\t\tstatus,\n\t\t\t\taverageRating,\n\t\t\t\tpopularityRank,\n\t\t\t\tratingRank,\n\t\t\t\t&filter[user_id]="+(t||182702)+"\n\t\t\t\t&filter[kind]="+(e||"anime")+"\n\t\t\t\t&filter[status]="+(n||"current")+"\t\t\t\t\n\t\t\t\t&include=\n\t\t\t\t"+(e||"anime")+",\n\t\t\t\tuser\n\t\t\t\t&page[offset]=0\n\t\t\t\t&page[limit]="+(a||20)+"\n\t\t\t\t&page[offset]="+(i||0)+"\n\t\t\t\t&sort=\n\t\t\t\tstatus\n\t\t\t",{headers:this.baseHeader}).then(function(t,e){return t.json()}).catch(function(t){return o(t)})},getMoreData:async function(t){return await fetch(u.getMoreLink[t],{headers:this.baseHeader}).then(function(t){return t.json()}).then(function(e){return u.getMoreLink[t]=e.links.next,e}).catch(function(t){return o(t)})}},l={allRoutes:[],searchUserInput:"",searchUserBtn:"",userView:"",overviewView:"",detailView:"",userId:""},c={animeData:{},mangaData:{},userDataAnime:{},userDataManga:{}},m={init:function(){this.routes(),l.userId=s.getData("userId"),location.hash||routie("library")},routes:function(){routie({library:async function(){console.log("Homepage",c),m.toggle("library");var t=s.getData("userData");s.checkData(t)||(l.userView.classList.add("anim__view--show"),c.userDataAnime=t,u.getMoreLink.userAnime=t.links.next,s.renderTemplate(".view__home","userOverview",c.userDataAnime),m.onScrollBottom("userAnime","userDataAnime",".view__home","userOverview"))},"library/manga":async function(){console.log("Library Manga",c);var t=s.getData("userDataManga");s.checkData(t)||(l.userView.classList.add("anim__view--show"),c.userDataManga=t,u.getMoreLink.userManga=t.links.next,s.renderTemplate(".view__home","userOverview",c.userDataManga,"manga"),m.onScrollBottom("userManga","userDataManga",".view__home","userOverview","manga"))},"library/:query":function(t){console.log("Library query: ",t);var e=l.userId||s.getData("userId");l.userView.classList.remove("anim__view--show"),m.loader.show(),u.getUserDataFilter(e,"anime",t,20,0).then(function(t){return c.userDataAnime=t}).then(function(t){s.renderTemplate(".view__home","userOverview",c.userDataAnime),l.userView.classList.add("anim__view--show"),m.loader.hide()})},"library/manga/:query":function(t){console.log("Library query Manga: ",t);var e=l.userId||s.getData("userId");l.userView.classList.remove("anim__view--show"),m.loader.show(),u.getUserDataFilter(e,"manga",t,20,0).then(function(t){return c.userDataManga=t}).then(function(t){s.renderTemplate(".view__home","userOverview",c.userDataManga,"manga"),l.userView.classList.add("anim__view--show"),m.loader.hide()})},anime:function(){console.log("Anime overview"),m.toggle("overview");var t=s.getData("animeData");s.renderTemplate(".view__overview","overview",t),l.overviewView.classList.add("anim__view--show"),m.onScrollBottom("anime","animeData",".view__overview","overview")},"anime/:slug":function(t){console.log("Anime slug: ",t),m.toggle("details");var e=s.getData("animeData").data.filter(function(e){return e.attributes.slug===t});e.length||(e=s.getData("userData").included.filter(function(e){return e.attributes.slug===t})),s.renderTemplate(".detail","detail",e[0]),l.detailView.classList.add("anim__view--show"),window.onscroll=function(){}},manga:function(){console.log("Manga Overview"),m.toggle("overview");var t=s.getData("mangaData");s.renderTemplate(".view__overview","overview",t),l.overviewView.classList.add("anim__view--show"),m.onScrollBottom("manga","mangaData",".view__overview","overview")},"manga/:slug":function(t){console.log("Manga slug: ",t),m.toggle("details");var e=s.getData("mangaData").data.filter(function(e){return e.attributes.slug===t});e.length||(e=s.getData("userDataManga").included.filter(function(e){return e.attributes.slug===t})),s.renderTemplate(".detail","detail",e[0]),l.detailView.classList.add("anim__view--show"),window.onscroll=function(){}}})},toggle:function(t){console.log("Change route to: ",t),l.allRoutes.forEach(function(e){e.id===t?e.classList.remove("inactive"):e.classList.add("inactive")})},loader:{self:s.getElement("#loader"),show:function(){this.self.classList.remove("inactive")},hide:function(){this.self.classList.add("inactive")}},onScrollBottom:function(t,e,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"anime";window.onscroll=function(){var o=document.documentElement;o.scrollTop+window.innerHeight>=o.offsetHeight-1&&(u.getMoreData(t).then(function(t){return c[e]={data:[].concat(i(c[e].data),i(t.data)),links:t.links,meta:t.meta,included:t.included?[].concat(i(c[e].included),i(t.included)):[]},t}).then(function(t){s.renderTemplate(n,a,c[e],r)}),console.log("At the bottom"))}}};t=function(){var t=l.searchUserBtn,e=l.searchUserInput;t.addEventListener("click",async function(t){if(t.preventDefault(),e.value.length){l.userView.classList.remove("anim__view--show"),m.loader.show();var n=await u.searchForUser(e.value);if(n.data.length){c.userDataAnime=[],c.userDataManga=[];var i=await Promise.all([u.getUserData(n.data[0].id,null,20),u.getUserData(n.data[0].id,"manga",20)]),o=a(i,2),g=o[0],d=o[1];l.userId=n.data[0].id,s.setData("userId",n.data[0].id),s.setData("userData",g),s.setData("userDataManga",d),s.renderTemplate(".view__home","userOverview",g),l.userView.classList.add("anim__view--show"),m.loader.hide(),routie("library")}else{var v=r.errorPage("We cannot find "+e.value).overview;s.renderTemplate(".view__home",v),l.userView.classList.add("anim__view--show"),m.loader.hide()}}})},async function(){console.log("Initializing app");var e=s.getData("animeData"),n=s.getData("mangaData"),i=void 0,r=void 0;if(null===e||"undefined"===e||null===n||"undefined"===n){console.log("No anime data so set");var o=await Promise.all([s.getElements(".view"),u.get("anime",20),u.get("manga",20)]),g=a(o,3);l.allRoutes=g[0],i=g[1],r=g[2],s.setData("animeData",i),s.setData("mangaData",r),c.animeData=i,c.mangaData=r,u.getMoreLink.anime=i.links.next,u.getMoreLink.manga=r.links.next}else c.animeData=e,c.mangaData=n,u.getMoreLink.anime=e.links.next,u.getMoreLink.manga=n.links.next;var d=await Promise.all([s.getElements(".view"),s.getElement("#search-user-input"),s.getElement("#search-user-btn"),s.getElement(".view__home .anim__view"),s.getElement("#overview .anim__view"),s.getElement("#details .anim__view")]),v=a(d,6);l.allRoutes=v[0],l.searchUserInput=v[1],l.searchUserBtn=v[2],l.userView=v[3],l.overviewView=v[4],l.detailView=v[5],t(),m.init()}()});
